<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>서머힐 붕붕버스</title>
    
    <!-- PWA 설정 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="붕붕버스">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- 아이콘 설정 -->
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            max-height: 100vh;
            font-size: 18px;
            /* PWA 전체화면 최적화 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            /* 스크롤 바운스 완전 차단 */
            overscroll-behavior: none;
            overscroll-behavior-y: none;
            overscroll-behavior-x: none;
            -webkit-overscroll-behavior: none;
            -webkit-overscroll-behavior-y: none;
            -webkit-overscroll-behavior-x: none;
            /* iOS Safari 스크롤 바운스 차단 */
            -webkit-overflow-scrolling: auto;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        /* PWA 상태표시줄 영역 고려 */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            /* 상태표시줄 영역 고려 */
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            padding-left: max(20px, env(safe-area-inset-left));
            padding-right: max(20px, env(safe-area-inset-right));
            /* 스크롤 완전 차단 */
            overflow: hidden;
            position: relative;
        }

        /* 헤더 */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .app-title {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .date-time {
            font-size: 20px;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .current-time {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        /* 하단 정보 */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .app-version {
            font-size: 18px;
            font-weight: bold;
            color: #4a5568;
        }

        /* 메인 버튼 영역 */
        .main-buttons {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .mode-button {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 20px;
            padding: 30px;
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(0);
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .mode-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .mode-button:active {
            transform: translateY(2px) scale(0.98);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.1s ease;
        }

        .mode-button.go-school {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .mode-button.go-school:active {
            background: linear-gradient(135deg, #3d8bfe 0%, #00d4e6 100%);
        }

        .mode-button.go-home {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .mode-button.go-home:active {
            background: linear-gradient(135deg, #38d16a 0%, #2de0c5 100%);
        }

        .mode-button.manage {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .mode-button.manage:active {
            background: linear-gradient(135deg, #f85d88 0%, #fed02e 100%);
        }

        /* 하단 정보 */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .driver-info {
            font-size: 20px;
            font-weight: bold;
            color: #4a5568;
        }

        /* 팝업 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        /* 등원/하원 리스트용 전체화면 모달 */
        .modal-content.fullscreen {
            margin: 0;
            width: 100%;
            height: 100%;
            max-height: 100vh;
            border-radius: 0;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
        }

        .modal.show .modal-content.fullscreen {
            transform: translateY(0);
        }

        .modal-content.fullscreen .modal-header {
            flex-shrink: 0;
            padding: 25px 20px;
            font-size: 28px;
        }

        .modal-content.fullscreen .modal-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: none;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .close:active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-50%) scale(0.95);
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* 리스트 아이템 */
        .list-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .child-name {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 12px;
        }

        .time-location {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .name-time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .time {
            font-size: 22px;
            font-weight: bold;
            color: #4299e1;
            background: #e6f3ff;
            padding: 8px 16px;
            border-radius: 10px;
        }

        .location {
            font-size: 25px;
            color: #718096;
            font-weight: bold;
            padding-left: 5px;
        }

        /* 관리 모달 특별 스타일 */
        .manage-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
            transform: translateY(0);
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:active {
            background: #3182ce;
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:active {
            background: #38a169;
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:active {
            background: #e53e3e;
            transform: translateY(1px) scale(0.98);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(110%);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 20px;
            transition: all 0.2s ease;
            user-select: text;
            -webkit-user-select: text;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            transform: scale(1.02);
        }

        .form-group input:active {
            transform: scale(1.01);
        }

        /* 빈 상태 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state .message {
            font-size: 20px;
        }

        /* 반응형 디자인 */
        @media (max-width: 480px) {
            body {
                height: 100vh;
                max-height: 100vh;
                overflow: hidden;
                position: fixed;
            }
            
            .container {
                padding: 15px;
                height: 100vh;
                max-height: 100vh;
                overflow: hidden;
            }
            
            .mode-button {
                font-size: 28px;
                padding: 25px;
                min-height: 100px;
            }
            
            .modal-content {
                width: 100%;
                height: 100%;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
                display: flex;
                flex-direction: column;
            }
            
            .modal-header {
                flex-shrink: 0;
                padding: 25px 20px;
                font-size: 28px;
            }
            
            .modal-body {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
                max-height: none;
            }
            
            .time-location {
                flex-direction: column;
                gap: 8px;
            }
            
            .location {
                text-align: left;
            }
        }

        /* 커스텀 알림 애니메이션 */
        .custom-alert {
            transform: translateY(50px) scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .custom-alert.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        /* 스크롤바 스타일링 */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <div class="app-title">서머힐 붕붕버스</div>
            <div class="date-time" id="dateTime">2024년 3월 15일 (금)</div>
            <div class="current-time" id="currentTime">오전 08:30</div>
        </div>

        <!-- 메인 버튼들 -->
        <div class="main-buttons">
            <button class="mode-button go-school" onclick="openModal('go-school')">
                🚌 등원
            </button>
            <button class="mode-button go-home" onclick="openModal('go-home')">
                🏠 하원
            </button>
            <button class="mode-button manage" onclick="openModal('manage')">
                ⚙️ 관리
            </button>
            
            <!-- 버전 정보 -->
            <div class="app-version">수서서머힐 차량 시간표 앱 V1</div>
        </div>

    </div>

    <!-- 등원 모달 -->
    <div id="goSchoolModal" class="modal">
        <div class="modal-content fullscreen">
            <div class="modal-header">
                🚌 등원 리스트
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="goSchoolList">
                <!-- 등원 리스트가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 하원 모달 -->
    <div id="goHomeModal" class="modal">
        <div class="modal-content fullscreen">
            <div class="modal-header">
                🏠 하원 리스트
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="goHomeList">
                <!-- 하원 리스트가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 관리 모달 -->
    <div id="manageModal" class="modal">
        <div class="modal-content fullscreen">
            <div class="modal-header">
                ⚙️ 아이 정보 관리
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="manage-buttons">
                    <button class="btn btn-primary" onclick="showAddForm()">아이 추가</button>
                    <button class="btn btn-success" onclick="showFileUpload()">파일 업로드</button>
                </div>
                
                <div id="addForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #2d3748; font-size: 24px;">새 아이 추가</h3>
                    <div class="form-group">
                        <label for="childName">아이 이름</label>
                        <input type="text" id="childName" placeholder="이름을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="goSchoolTime">등원 시간</label>
                        <input type="time" id="goSchoolTime" value="08:00">
                    </div>
                    <div class="form-group">
                        <label for="goSchoolLocation">등원 장소</label>
                        <input type="text" id="goSchoolLocation" placeholder="등원 장소를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="goHomeTime">하원 시간</label>
                        <input type="time" id="goHomeTime" value="14:00">
                    </div>
                    <div class="form-group">
                        <label for="goHomeLocation">하원 장소</label>
                        <input type="text" id="goHomeLocation" placeholder="하원 장소를 입력하세요">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveChild()">저장</button>
                        <button class="btn btn-danger" onclick="cancelAdd()">취소</button>
                    </div>
                </div>

                <div id="fileUploadForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #2d3748; font-size: 24px;">파일로 일괄 업데이트</h3>
                    <div class="form-group">
                        <label for="fileInput">텍스트 파일 선택</label>
                        <input type="file" id="fileInput" accept=".txt" style="font-size: 20px; padding: 15px;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="uploadFile()">업로드</button>
                        <button class="btn btn-danger" onclick="cancelFileUpload()">취소</button>
                    </div>
                </div>

                <div id="childrenList">
                    <!-- 아이들 목록이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 데이터 저장소
        let childrenData = [];
        let settings = {
            driverName: '김운전',
            busNumber: '1호차'
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDateTime();
            updateDriverInfo();
            setInterval(updateDateTime, 1000); // 1초마다 시간 업데이트
            
            // 화면 꺼짐 방지
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen');
            }
            
            // Service Worker 등록 (PWA)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker 등록 성공:', registration);
                    })
                    .catch(function(error) {
                        console.log('Service Worker 등록 실패:', error);
                    });
            }
            
            // 스크롤 바운스 완전 차단
            document.body.addEventListener('touchmove', function(e) {
                // 모달이 열려있을 때만 스크롤 허용
                const openModal = document.querySelector('.modal[style*="display: block"]');
                if (!openModal) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // iOS Safari 주소창 숨기기
            window.addEventListener('load', function() {
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 100);
            });
        });

        // 데이터 로드
        function loadData() {
            const savedData = localStorage.getItem('kindergartenBusData');
            const savedSettings = localStorage.getItem('kindergartenBusSettings');
            
            if (savedData) {
                childrenData = JSON.parse(savedData);
            } else {
                // 초기 데모 데이터
                childrenData = [
                    {
                        id: 1,
                        name: '김민수',
                        goSchool: { time: '08:30', location: '아파트 정문' },
                        goHome: { time: '14:30', location: '아파트 정문' }
                    },
                    {
                        id: 2,
                        name: '이하늘',
                        goSchool: { time: '08:35', location: '놀이터' },
                        goHome: { time: '14:35', location: '놀이터' }
                    },
                    {
                        id: 3,
                        name: '박지우',
                        goSchool: { time: '08:45', location: '204동' },
                        goHome: { time: '14:45', location: '204동' }
                    }
                ];
            }
            
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
            }
        }

        // 데이터 저장
        function saveData() {
            localStorage.setItem('kindergartenBusData', JSON.stringify(childrenData));
            localStorage.setItem('kindergartenBusSettings', JSON.stringify(settings));
        }

        // 시간 업데이트
        function updateDateTime() {
            const now = new Date();
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const day = days[now.getDay()];
            
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours < 12 ? '오전' : '오후';
            const displayHours = hours % 12 || 12;
            
            document.getElementById('dateTime').textContent = `${year}년 ${month}월 ${date}일 (${day})`;
            document.getElementById('currentTime').textContent = `${ampm} ${displayHours}:${minutes}`;
        }

        // 운전기사 정보 업데이트 (필요시에만)
        function updateDriverInfo() {
            // 하단 정보가 제거되었으므로 빈 함수로 유지
            return;
        }

        // 모달 열기 (애니메이션 적용)
        function openModal(type) {
            const modal = document.getElementById(type === 'go-school' ? 'goSchoolModal' : 
                                               type === 'go-home' ? 'goHomeModal' : 'manageModal');
            
            // 모달 표시
            modal.style.display = 'block';
            
            // 애니메이션을 위한 약간의 지연
            requestAnimationFrame(() => {
                modal.classList.add('show');
            });
            
            if (type === 'go-school') {
                renderGoSchoolList();
            } else if (type === 'go-home') {
                renderGoHomeList();
            } else if (type === 'manage') {
                renderManageList();
            }
        }

        // 모달 닫기 (애니메이션 적용)
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (modal.classList.contains('show')) {
                    modal.classList.remove('show');
                    
                    // 애니메이션이 끝난 후 완전히 숨김
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 400); // CSS transition 시간과 맞춤
                }
            });
            hideAllForms();
        }

        // 등원 리스트 렌더링
        function renderGoSchoolList() {
            const container = document.getElementById('goSchoolList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>관리 메뉴에서 아이를 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            // 시간순으로 정렬
            const sortedData = [...childrenData].sort((a, b) => a.goSchool.time.localeCompare(b.goSchool.time));
            
            container.innerHTML = sortedData.map(child => `
                <div class="list-item">
                    <div class="name-time">
                        <div class="child-name">${child.name}</div>
                        <div class="time">오전 ${child.goSchool.time}</div>
                    </div>
                    <div class="location">📍 ${child.goSchool.location}</div>
                </div>
            `).join('');
        }

        // 하원 리스트 렌더링
        function renderGoHomeList() {
            const container = document.getElementById('goHomeList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>관리 메뉴에서 아이를 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            // 시간순으로 정렬
            const sortedData = [...childrenData].sort((a, b) => a.goHome.time.localeCompare(b.goHome.time));
            
            container.innerHTML = sortedData.map(child => `
                <div class="list-item">
                    <div class="name-time">
                        <div class="child-name">${child.name}</div>
                        <div class="time">오후 ${child.goHome.time}</div>
                    </div>
                    <div class="location">📍 ${child.goHome.location}</div>
                </div>
            `).join('');
        }

        // 관리 리스트 렌더링 (수정됨)
        function renderManageList() {
            const container = document.getElementById('childrenList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>위의 "아이 추가" 버튼을 눌러 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h3 style="margin: 20px 0; color: #2d3748; font-size: 24px;">등록된 아이들</h3>
                ${childrenData.map(child => `
                    <div class="list-item">
                        <div class="child-name">${child.name}</div>
                        <div style="margin-top: 10px; font-size: 24px; color: #718096;">
                            <div>등원: ${child.goSchool.time} | ${child.goSchool.location}</div>
                            <div>하원: ${child.goHome.time} | ${child.goHome.location}</div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary child-edit-btn" data-child-id="${child.id}" style="margin-right: 10px; font-size: 18px; padding: 8px 15px;">수정</button>
                            <button class="btn btn-danger child-delete-btn" data-child-id="${child.id}" style="font-size: 18px; padding: 8px 15px;">삭제</button>
                        </div>
                    </div>
                `).join('')}
            `;
            
            // 이벤트 리스너 추가
            addChildManagementListeners();
        }

        // 아이 관리 버튼 이벤트 리스너 추가
        function addChildManagementListeners() {
            // 수정 버튼들
            document.querySelectorAll('.child-edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const childId = parseInt(this.getAttribute('data-child-id'));
                    editChild(childId);
                });
            });
            
            // 삭제 버튼들
            document.querySelectorAll('.child-delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const childId = parseInt(this.getAttribute('data-child-id'));
                    deleteChild(childId);
                });
            });
        }

        // 폼 표시/숨김 관련 함수들
        function hideAllForms() {
            document.getElementById('addForm').style.display = 'none';
            document.getElementById('fileUploadForm').style.display = 'none';
        }

        function showAddForm() {
            hideAllForms();
            document.getElementById('addForm').style.display = 'block';
            clearAddForm();
        }

        function showFileUpload() {
            hideAllForms();
            document.getElementById('fileUploadForm').style.display = 'block';
            document.getElementById('fileInput').value = '';
        }

        function clearAddForm() {
            document.getElementById('childName').value = '';
            document.getElementById('goSchoolTime').value = '08:00';
            document.getElementById('goSchoolLocation').value = '';
            document.getElementById('goHomeTime').value = '14:00';
            document.getElementById('goHomeLocation').value = '';
        }

        function cancelAdd() {
            hideAllForms();
            renderManageList();
        }

        function cancelFileUpload() {
            hideAllForms();
            renderManageList();
        }

        // 파일 업로드 처리 (개선됨)
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('파일을 선택해주세요.');
                return;
            }
            
            if (!file.name.toLowerCase().endsWith('.txt')) {
                showAlert('텍스트 파일(.txt)만 업로드 가능합니다.');
                return;
            }
            
            // 파일 읽기 시작
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    console.log('파일 내용:', content); // 디버깅용
                    parseFileContent(content);
                } catch (error) {
                    console.error('파일 읽기 오류:', error);
                    showAlert('파일을 읽는 중 오류가 발생했습니다.');
                }
            };
            
            reader.onerror = function() {
                showAlert('파일을 읽을 수 없습니다.');
            };
            
            // UTF-8로 파일 읽기
            reader.readAsText(file, 'UTF-8');
        }
        
        // 파일 내용 파싱 (개선됨)
        function parseFileContent(content) {
            if (!content || content.trim() === '') {
                showAlert('파일이 비어있습니다.');
                return;
            }
            
            // 줄바꿈으로 분할하고 빈 줄 제거
            const lines = content.split(/\r?\n/).filter(line => line.trim() !== '');
            console.log('파싱된 줄들:', lines); // 디버깅용
            
            if (lines.length === 0) {
                showAlert('파일에 데이터가 없습니다.');
                return;
            }
            
            const newChildrenData = [];
            let errorCount = 0;
            let errorLines = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                console.log(`줄 ${i + 1}: "${line}"`); // 디버깅용
                
                // 콤마로 분할
                const parts = line.split(',').map(part => part.trim());
                console.log(`분할된 부분:`, parts); // 디버깅용
                
                if (parts.length !== 5) {
                    errorCount++;
                    errorLines.push(`줄 ${i + 1}: 항목 수가 맞지 않음 (${parts.length}개, 5개 필요)`);
                    continue;
                }
                
                const [name, goSchoolTime, goSchoolLocation, goHomeTime, goHomeLocation] = parts;
                
                // 필수 항목 체크
                if (!name || !goSchoolTime || !goSchoolLocation || !goHomeTime || !goHomeLocation) {
                    errorCount++;
                    errorLines.push(`줄 ${i + 1}: 빈 항목이 있음`);
                    continue;
                }
                
                // 시간 형식 검증 (더 유연하게)
                const timeRegex = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/;
                if (!timeRegex.test(goSchoolTime)) {
                    errorCount++;
                    errorLines.push(`줄 ${i + 1}: 등원 시간 형식 오류 (${goSchoolTime})`);
                    continue;
                }
                
                if (!timeRegex.test(goHomeTime)) {
                    errorCount++;
                    errorLines.push(`줄 ${i + 1}: 하원 시간 형식 오류 (${goHomeTime})`);
                    continue;
                }
                
                // 데이터 추가
                newChildrenData.push({
                    id: Date.now() + i,
                    name: name,
                    goSchool: { time: goSchoolTime, location: goSchoolLocation },
                    goHome: { time: goHomeTime, location: goHomeLocation }
                });
                
                console.log(`성공적으로 추가된 아이: ${name}`); // 디버깅용
            }
            
            console.log(`총 ${newChildrenData.length}명 파싱됨, ${errorCount}개 오류`); // 디버깅용
            
            if (newChildrenData.length === 0) {
                let errorMessage = '올바른 형식의 데이터가 없습니다.\n\n';
                errorMessage += '형식: 이름,등원시간,등원장소,하원시간,하원장소\n';
                errorMessage += '예시: 김민수,08:30,아파트 정문,14:30,아파트 정문\n\n';
                if (errorLines.length > 0) {
                    errorMessage += '오류 내용:\n' + errorLines.slice(0, 3).join('\n');
                    if (errorLines.length > 3) {
                        errorMessage += `\n... 외 ${errorLines.length - 3}개`;
                    }
                }
                showAlert(errorMessage);
                return;
            }
            
            const message = `${newChildrenData.length}명의 아이 정보를 업로드합니다.` + 
                          (errorCount > 0 ? `\n(${errorCount}줄은 형식 오류로 제외됨)` : '') +
                          '\n\n기존 데이터는 모두 삭제됩니다. 계속하시겠습니까?';
                          
            showConfirm(message, function() {
                childrenData = newChildrenData;
                saveData();
                hideAllForms();
                renderManageList();
                showAlert(`${newChildrenData.length}명의 아이 정보가 성공적으로 업로드되었습니다!`);
            });
        }

        // 커스텀 alert 함수 (애니메이션 적용)
        function showAlert(message) {
            // 기존 알림이 있다면 제거
            const existingAlert = document.querySelector('.custom-alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // 새로운 알림 생성
            const alertDiv = document.createElement('div');
            alertDiv.className = 'custom-alert';
            alertDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) translateY(50px) scale(0.9);
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                text-align: center;
                min-width: 300px;
                max-width: 90%;
                opacity: 0;
            `;
            
            alertDiv.innerHTML = `
                <div style="font-size: 20px; color: #2d3748; margin-bottom: 20px; line-height: 1.5;">
                    ${message}
                </div>
                <button onclick="closeAlert(this.parentElement)" style="
                    background: #4299e1;
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 8px;
                    font-size: 20px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    user-select: none;
                    -webkit-user-select: none;
                    -webkit-tap-highlight-color: transparent;
                " 
                onmousedown="this.style.transform='scale(0.95)'; this.style.background='#3182ce'"
                onmouseup="this.style.transform='scale(1)'; this.style.background='#4299e1'"
                onmouseleave="this.style.transform='scale(1)'; this.style.background='#4299e1'">확인</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 애니메이션 시작
            requestAnimationFrame(() => {
                alertDiv.classList.add('show');
            });
        }

        // 알림 닫기 애니메이션
        function closeAlert(alertElement) {
            alertElement.classList.remove('show');
            setTimeout(() => {
                alertElement.remove();
            }, 300);
        }

        // 커스텀 confirm 함수 (애니메이션 적용)
        function showConfirm(message, onConfirm) {
            // 기존 알림이 있다면 제거
            const existingAlert = document.querySelector('.custom-alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // 새로운 확인창 생성
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'custom-alert';
            confirmDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) translateY(50px) scale(0.9);
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                text-align: center;
                min-width: 300px;
                max-width: 90%;
                opacity: 0;
            `;
            
            confirmDiv.innerHTML = `
                <div style="font-size: 20px; color: #2d3748; margin-bottom: 20px; line-height: 1.5;">
                    ${message}
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="confirm-yes" style="
                        background: #f56565;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-size: 20px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        user-select: none;
                        -webkit-user-select: none;
                        -webkit-tap-highlight-color: transparent;
                    " 
                    onmousedown="this.style.transform='scale(0.95)'; this.style.background='#e53e3e'"
                    onmouseup="this.style.transform='scale(1)'; this.style.background='#f56565'"
                    onmouseleave="this.style.transform='scale(1)'; this.style.background='#f56565'">확인</button>
                    <button class="confirm-no" style="
                        background: #718096;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-size: 20px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        user-select: none;
                        -webkit-user-select: none;
                        -webkit-tap-highlight-color: transparent;
                    "
                    onmousedown="this.style.transform='scale(0.95)'; this.style.background='#4a5568'"
                    onmouseup="this.style.transform='scale(1)'; this.style.background='#718096'"
                    onmouseleave="this.style.transform='scale(1)'; this.style.background='#718096'">취소</button>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
            
            // 애니메이션 시작
            requestAnimationFrame(() => {
                confirmDiv.classList.add('show');
            });
            
            // 이벤트 리스너 추가
            confirmDiv.querySelector('.confirm-yes').onclick = function() {
                closeAlert(confirmDiv);
                setTimeout(onConfirm, 150); // 애니메이션 후 실행
            };
            
            confirmDiv.querySelector('.confirm-no').onclick = function() {
                closeAlert(confirmDiv);
            };
        }

        // 아이 저장
        function saveChild() {
            const name = document.getElementById('childName').value.trim();
            const goSchoolTime = document.getElementById('goSchoolTime').value;
            const goSchoolLocation = document.getElementById('goSchoolLocation').value.trim();
            const goHomeTime = document.getElementById('goHomeTime').value;
            const goHomeLocation = document.getElementById('goHomeLocation').value.trim();
            
            if (!name || !goSchoolLocation || !goHomeLocation) {
                showAlert('모든 필드를 입력해주세요.');
                return;
            }
            
            const newChild = {
                id: Date.now(),
                name: name,
                goSchool: { time: goSchoolTime, location: goSchoolLocation },
                goHome: { time: goHomeTime, location: goHomeLocation }
            };
            
            childrenData.push(newChild);
            saveData();
            hideAllForms();
            renderManageList();
            showAlert('아이 정보가 저장되었습니다.');
        }

        // 설정 저장 (제거됨)
        // function saveSettings() - 더 이상 사용하지 않음

        // 아이 삭제 (개선됨)
        function deleteChild(id) {
            console.log('삭제 요청된 아이 ID:', id); // 디버깅용
            
            const child = childrenData.find(c => c.id === id);
            if (!child) {
                console.error('아이를 찾을 수 없습니다. ID:', id);
                showAlert('삭제할 아이를 찾을 수 없습니다.');
                return;
            }
            
            console.log('삭제할 아이:', child.name); // 디버깅용
            
            showConfirm(`${child.name} 아이의 정보를 정말로 삭제하시겠습니까?`, function() {
                // 데이터에서 제거
                const originalLength = childrenData.length;
                childrenData = childrenData.filter(c => c.id !== id);
                
                console.log(`삭제 전: ${originalLength}명, 삭제 후: ${childrenData.length}명`); // 디버깅용
                
                if (childrenData.length === originalLength) {
                    console.error('삭제가 실행되지 않았습니다.');
                    showAlert('삭제에 실패했습니다.');
                    return;
                }
                
                // 데이터 저장 및 화면 업데이트
                saveData();
                renderManageList();
                showAlert(`${child.name} 아이의 정보가 삭제되었습니다.`);
            });
        }

        // 아이 수정 (개선됨)
        function editChild(id) {
            console.log('수정 요청된 아이 ID:', id); // 디버깅용
            
            const child = childrenData.find(c => c.id === id);
            if (!child) {
                console.error('아이를 찾을 수 없습니다. ID:', id);
                showAlert('수정할 아이를 찾을 수 없습니다.');
                return;
            }
            
            console.log('수정할 아이:', child.name); // 디버깅용
            
            // 수정 폼을 모달로 생성
            const editModal = document.createElement('div');
            editModal.className = 'modal';
            editModal.style.display = 'block';
            
            editModal.innerHTML = `
                <div class="modal-content fullscreen">
                    <div class="modal-header">
                        ✏️ ${child.name} 정보 수정
                        <span class="close" onclick="closeEditModal(this.closest('.modal'))">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>아이 이름</label>
                            <input type="text" id="editChildName" value="${child.name}" style="font-size: 20px;">
                        </div>
                        <div class="form-group">
                            <label>등원 시간</label>
                            <input type="time" id="editGoSchoolTime" value="${child.goSchool.time}" style="font-size: 20px;">
                        </div>
                        <div class="form-group">
                            <label>등원 장소</label>
                            <input type="text" id="editGoSchoolLocation" value="${child.goSchool.location}" style="font-size: 20px;">
                        </div>
                        <div class="form-group">
                            <label>하원 시간</label>
                            <input type="time" id="editGoHomeTime" value="${child.goHome.time}" style="font-size: 20px;">
                        </div>
                        <div class="form-group">
                            <label>하원 장소</label>
                            <input type="text" id="editGoHomeLocation" value="${child.goHome.location}" style="font-size: 20px;">
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="saveEditChild(${child.id})">저장</button>
                            <button class="btn btn-danger" onclick="closeEditModal(this.closest('.modal'))">취소</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(editModal);
            
            // 애니메이션 시작
            requestAnimationFrame(() => {
                editModal.classList.add('show');
            });
        }

        // 수정 모달 닫기 애니메이션
        function closeEditModal(modal) {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.remove();
            }, 400);
        }

        // 수정된 아이 정보 저장 (제거 - 새로운 함수로 대체됨)
        // saveEditChild 함수는 saveEditChildById로 대체됨

        // 모달 외부 클릭시 닫기 (애니메이션 적용)
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal && modal.classList.contains('show')) {
                    closeModal();
                }
            });
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>어린이집 차량 운행 관리</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            font-size: 18px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 헤더 */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .date-time {
            font-size: 24px;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .current-time {
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
        }

        /* 메인 버튼 영역 */
        .main-buttons {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .mode-button {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 20px;
            padding: 30px;
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mode-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .mode-button:active {
            transform: translateY(0);
        }

        .mode-button.go-school {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .mode-button.go-home {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .mode-button.manage {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        /* 하단 정보 */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .driver-info {
            font-size: 20px;
            font-weight: bold;
            color: #4a5568;
        }

        /* 팝업 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* 리스트 아이템 */
        .list-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .child-name {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .time-location {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .time {
            font-size: 20px;
            font-weight: bold;
            color: #4299e1;
            background: #e6f3ff;
            padding: 8px 15px;
            border-radius: 10px;
        }

        .location {
            font-size: 18px;
            color: #718096;
            flex: 1;
            min-width: 120px;
            text-align: right;
        }

        /* 관리 모달 특별 스타일 */
        .manage-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 80px;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(110%);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 18px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        /* 빈 상태 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state .message {
            font-size: 18px;
        }

        /* 반응형 디자인 */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .mode-button {
                font-size: 28px;
                padding: 25px;
                min-height: 100px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .time-location {
                flex-direction: column;
                gap: 8px;
            }
            
            .location {
                text-align: left;
            }
        }

        /* 스크롤바 스타일링 */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <div class="date-time" id="dateTime">2024년 3월 15일 (금)</div>
            <div class="current-time" id="currentTime">오전 08:30</div>
        </div>

        <!-- 메인 버튼들 -->
        <div class="main-buttons">
            <button class="mode-button go-school" onclick="openModal('go-school')">
                🚌 등원
            </button>
            <button class="mode-button go-home" onclick="openModal('go-home')">
                🏠 하원
            </button>
            <button class="mode-button manage" onclick="openModal('manage')">
                ⚙️ 관리
            </button>
        </div>

        <!-- 하단 정보 -->
        <div class="footer">
            <div class="driver-info" id="driverInfo">
                <span id="driverName">김운전</span> 기사님 | 
                <span id="busNumber">1호차</span>
            </div>
        </div>
    </div>

    <!-- 등원 모달 -->
    <div id="goSchoolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                🚌 등원 리스트
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="goSchoolList">
                <!-- 등원 리스트가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 하원 모달 -->
    <div id="goHomeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                🏠 하원 리스트
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="goHomeList">
                <!-- 하원 리스트가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 관리 모달 -->
    <div id="manageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                ⚙️ 아이 정보 관리
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="manage-buttons">
                    <button class="btn btn-primary" onclick="showAddForm()">아이 추가</button>
                    <button class="btn btn-success" onclick="showSettings()">설정</button>
                </div>
                
                <div id="addForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">새 아이 추가</h3>
                    <div class="form-group">
                        <label for="childName">아이 이름</label>
                        <input type="text" id="childName" placeholder="이름을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="goSchoolTime">등원 시간</label>
                        <input type="time" id="goSchoolTime" value="08:00">
                    </div>
                    <div class="form-group">
                        <label for="goSchoolLocation">등원 장소</label>
                        <input type="text" id="goSchoolLocation" placeholder="등원 장소를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="goHomeTime">하원 시간</label>
                        <input type="time" id="goHomeTime" value="14:00">
                    </div>
                    <div class="form-group">
                        <label for="goHomeLocation">하원 장소</label>
                        <input type="text" id="goHomeLocation" placeholder="하원 장소를 입력하세요">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveChild()">저장</button>
                        <button class="btn btn-danger" onclick="cancelAdd()">취소</button>
                    </div>
                </div>

                <div id="settingsForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">기본 설정</h3>
                    <div class="form-group">
                        <label for="settingDriverName">운전기사 이름</label>
                        <input type="text" id="settingDriverName" placeholder="기사님 이름">
                    </div>
                    <div class="form-group">
                        <label for="settingBusNumber">차량 번호</label>
                        <input type="text" id="settingBusNumber" placeholder="차량 번호">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveSettings()">저장</button>
                        <button class="btn btn-danger" onclick="cancelSettings()">취소</button>
                    </div>
                </div>

                <div id="childrenList">
                    <!-- 아이들 목록이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 데이터 저장소
        let childrenData = [];
        let settings = {
            driverName: '김운전',
            busNumber: '1호차'
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDateTime();
            updateDriverInfo();
            setInterval(updateDateTime, 1000); // 1초마다 시간 업데이트
            
            // 화면 꺼짐 방지
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen');
            }
        });

        // 데이터 로드
        function loadData() {
            const savedData = localStorage.getItem('kindergartenBusData');
            const savedSettings = localStorage.getItem('kindergartenBusSettings');
            
            if (savedData) {
                childrenData = JSON.parse(savedData);
            } else {
                // 초기 데모 데이터
                childrenData = [
                    {
                        id: 1,
                        name: '김민수',
                        goSchool: { time: '08:30', location: '아파트 정문' },
                        goHome: { time: '14:30', location: '아파트 정문' }
                    },
                    {
                        id: 2,
                        name: '이하늘',
                        goSchool: { time: '08:35', location: '놀이터' },
                        goHome: { time: '14:35', location: '놀이터' }
                    },
                    {
                        id: 3,
                        name: '박지우',
                        goSchool: { time: '08:45', location: '204동' },
                        goHome: { time: '14:45', location: '204동' }
                    }
                ];
            }
            
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
            }
        }

        // 데이터 저장
        function saveData() {
            localStorage.setItem('kindergartenBusData', JSON.stringify(childrenData));
            localStorage.setItem('kindergartenBusSettings', JSON.stringify(settings));
        }

        // 시간 업데이트
        function updateDateTime() {
            const now = new Date();
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const day = days[now.getDay()];
            
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours < 12 ? '오전' : '오후';
            const displayHours = hours % 12 || 12;
            
            document.getElementById('dateTime').textContent = `${year}년 ${month}월 ${date}일 (${day})`;
            document.getElementById('currentTime').textContent = `${ampm} ${displayHours}:${minutes}`;
        }

        // 운전기사 정보 업데이트
        function updateDriverInfo() {
            document.getElementById('driverName').textContent = settings.driverName;
            document.getElementById('busNumber').textContent = settings.busNumber;
        }

        // 모달 열기
        function openModal(type) {
            const modal = document.getElementById(type === 'go-school' ? 'goSchoolModal' : 
                                               type === 'go-home' ? 'goHomeModal' : 'manageModal');
            modal.style.display = 'block';
            
            if (type === 'go-school') {
                renderGoSchoolList();
            } else if (type === 'go-home') {
                renderGoHomeList();
            } else if (type === 'manage') {
                renderManageList();
            }
        }

        // 모달 닫기
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => modal.style.display = 'none');
            hideAllForms();
        }

        // 등원 리스트 렌더링
        function renderGoSchoolList() {
            const container = document.getElementById('goSchoolList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>관리 메뉴에서 아이를 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            // 시간순으로 정렬
            const sortedData = [...childrenData].sort((a, b) => a.goSchool.time.localeCompare(b.goSchool.time));
            
            container.innerHTML = sortedData.map(child => `
                <div class="list-item">
                    <div class="child-name">${child.name}</div>
                    <div class="time-location">
                        <div class="time">오전 ${child.goSchool.time}</div>
                        <div class="location">📍 ${child.goSchool.location}</div>
                    </div>
                </div>
            `).join('');
        }

        // 하원 리스트 렌더링
        function renderGoHomeList() {
            const container = document.getElementById('goHomeList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>관리 메뉴에서 아이를 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            // 시간순으로 정렬
            const sortedData = [...childrenData].sort((a, b) => a.goHome.time.localeCompare(b.goHome.time));
            
            container.innerHTML = sortedData.map(child => `
                <div class="list-item">
                    <div class="child-name">${child.name}</div>
                    <div class="time-location">
                        <div class="time">오후 ${child.goHome.time}</div>
                        <div class="location">📍 ${child.goHome.location}</div>
                    </div>
                </div>
            `).join('');
        }

        // 관리 리스트 렌더링
        function renderManageList() {
            const container = document.getElementById('childrenList');
            
            if (childrenData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">👶</div>
                        <div class="message">등록된 아이가 없습니다.<br>위의 "아이 추가" 버튼을 눌러 추가해주세요.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h3 style="margin: 20px 0; color: #2d3748;">등록된 아이들</h3>
                ${childrenData.map(child => `
                    <div class="list-item">
                        <div class="child-name">${child.name}</div>
                        <div style="margin-top: 10px; font-size: 16px; color: #718096;">
                            <div>등원: ${child.goSchool.time} | ${child.goSchool.location}</div>
                            <div>하원: ${child.goHome.time} | ${child.goHome.location}</div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="editChild(${child.id})" style="margin-right: 10px; font-size: 14px; padding: 8px 15px;">수정</button>
                            <button class="btn btn-danger" onclick="deleteChild(${child.id})" style="font-size: 14px; padding: 8px 15px;">삭제</button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // 폼 표시/숨김 관련 함수들
        function hideAllForms() {
            document.getElementById('addForm').style.display = 'none';
            document.getElementById('settingsForm').style.display = 'none';
        }

        function showAddForm() {
            hideAllForms();
            document.getElementById('addForm').style.display = 'block';
            clearAddForm();
        }

        function showSettings() {
            hideAllForms();
            document.getElementById('settingsForm').style.display = 'block';
            document.getElementById('settingDriverName').value = settings.driverName;
            document.getElementById('settingBusNumber').value = settings.busNumber;
        }

        function clearAddForm() {
            document.getElementById('childName').value = '';
            document.getElementById('goSchoolTime').value = '08:00';
            document.getElementById('goSchoolLocation').value = '';
            document.getElementById('goHomeTime').value = '14:00';
            document.getElementById('goHomeLocation').value = '';
        }

        function cancelAdd() {
            hideAllForms();
            renderManageList();
        }

        function cancelSettings() {
            hideAllForms();
        }

        // 아이 저장
        function saveChild() {
            const name = document.getElementById('childName').value.trim();
            const goSchoolTime = document.getElementById('goSchoolTime').value;
            const goSchoolLocation = document.getElementById('goSchoolLocation').value.trim();
            const goHomeTime = document.getElementById('goHomeTime').value;
            const goHomeLocation = document.getElementById('goHomeLocation').value.trim();
            
            if (!name || !goSchoolLocation || !goHomeLocation) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            const newChild = {
                id: Date.now(),
                name: name,
                goSchool: { time: goSchoolTime, location: goSchoolLocation },
                goHome: { time: goHomeTime, location: goHomeLocation }
            };
            
            childrenData.push(newChild);
            saveData();
            hideAllForms();
            renderManageList();
            alert('아이 정보가 저장되었습니다.');
        }

        // 설정 저장
        function saveSettings() {
            const driverName = document.getElementById('settingDriverName').value.trim();
            const busNumber = document.getElementById('settingBusNumber').value.trim();
            
            if (!driverName || !busNumber) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            settings.driverName = driverName;
            settings.busNumber = busNumber;
            saveData();
            updateDriverInfo();
            hideAllForms();
            alert('설정이 저장되었습니다.');
        }

        // 아이 삭제
        function deleteChild(id) {
            if (confirm('정말로 삭제하시겠습니까?')) {
                childrenData = childrenData.filter(child => child.id !== id);
                saveData();
                renderManageList();
                alert('삭제되었습니다.');
            }
        }

        // 아이 수정 (간단한 구현)
        function editChild(id) {
            const child = childrenData.find(c => c.id === id);
            if (!child) return;
            
            const newName = prompt('이름:', child.name);
            if (newName === null) return;
            
            const newGoSchoolTime = prompt('등원 시간 (HH:MM):', child.goSchool.time);
            if (newGoSchoolTime === null) return;
            
            const newGoSchoolLocation = prompt('등원 장소:', child.goSchool.location);
            if (newGoSchoolLocation === null) return;
            
            const newGoHomeTime = prompt('하원 시간 (HH:MM):', child.goHome.time);
            if (newGoHomeTime === null) return;
            
            const newGoHomeLocation = prompt('하원 장소:', child.goHome.location);
            if (newGoHomeLocation === null) return;
            
            child.name = newName.trim();
            child.goSchool.time = newGoSchoolTime;
            child.goSchool.location = newGoSchoolLocation.trim();
            child.goHome.time = newGoHomeTime;
            child.goHome.location = newGoHomeLocation.trim();
            
            saveData();
            renderManageList();
            alert('수정되었습니다.');
        }

        // 모달 외부 클릭시 닫기
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    closeModal();
                }
            });
        }
    </script>
</body>
</html>
